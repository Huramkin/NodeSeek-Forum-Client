# NodeSeek DeepFlood 客户端 — 待扩展功能清单

> 本文档基于对当前代码库的全面审查，梳理出尚未实现或需要进一步完善的功能模块。  
> 按优先级和所属阶段划分，供后续迭代参考。

---

## 一、本次代码审查发现并已修复的问题

| # | 问题描述 | 文件 | 严重程度 |
|---|---------|------|---------|
| 1 | `browserElectronApi` mock 缺少 `incrementVisit`、`batch`、`folders` API，浏览器开发模式下文件夹/批量操作崩溃 | `src/renderer/mocks/browserElectronApi.ts` | 高 |
| 2 | `ResourceMonitor` 使用 `process.getProcessMemoryInfo?.()` — 该 API 仅在渲染进程可用，主进程应使用 `process.memoryUsage()` | `src/main/services/resourceMonitor.ts` | 高 |
| 3 | `powerMonitor.on('suspend'/'resume')` 每次调用 `start()` 都会重复注册事件监听器，造成内存泄漏 | `src/main/services/resourceMonitor.ts` | 高 |
| 4 | `normalizeAddress` 正则 `/^[\w.-]+\.[a-z]{2,}$/i` 不支持带路径的裸域名（如 `nodeseek.com/post/123`），会被错误识别为搜索关键字 | `src/renderer/utils/url.ts` | 中 |
| 5 | `updateBookmark` / `updateFolder` 直接将 payload key 拼接进 SQL 字符串，存在 SQL 注入风险 | `src/main/services/bookmarkManager.ts` | 高 |
| 6 | 应用退出时未调用 `bookmarkManager.dispose()` / `resourceMonitor.dispose()` 清理资源 | `src/main/main.ts` | 中 |
| 7 | `closeTab` 关闭当前标签页后直接选中第一个标签页，而非相邻标签页，UX 不佳 | `src/main/services/tabManager.ts` | 低 |
| 8 | `webview` JSX 类型定义中 `allowpopups` 应为 `string` 而非 `boolean`；缺少 `reloadIgnoringCache` 声明 | `src/renderer/types/jsx.d.ts` | 低 |
| 9 | `.gitignore` 忽略了 `package-lock.json`，但 CI（GitHub Actions）的 `npm ci` 依赖它 | `.gitignore` | 中 |
| 10 | `replaceAllBookmarks` 方法为死代码且缺少多个字段，已清除 | `src/main/services/bookmarkManager.ts` | 低 |
| 11 | `tsconfig.base.json` 的 `module: ESNext` 与 `moduleResolution: NodeNext` 不兼容 | `tsconfig.base.json` | 中 |

---

## 二、待扩展功能详细列表

### 阶段二：认证系统（Auth） — 当前状态：仅后端骨架

**现有基础：** `AuthManager` 使用 `keytar` 存储凭证，`SessionManager` 管理 cookie。

| # | 功能 | 说明 | 优先级 |
|---|------|------|--------|
| A-1 | 登录界面 UI | 目前无任何登录 UI。需要实现一个内嵌的登录页面或 OAuth 流程，用于让用户输入 NodeSeek 帐号密码或通过网页登录捕获 cookie | P0 |
| A-2 | 多账号管理 UI | 数据库已有 `accounts` 表，但无 UI 进行账号切换和管理。需要一个账号列表面板，支持添加/删除/切换账号 | P1 |
| A-3 | 登录状态指示 | 配置中有 `showLoginStatus` 字段，但 UI 中未体现。需要在标题栏或地址栏区域显示当前登录用户名和状态 | P1 |
| A-4 | 会话自动刷新 | 配置中有 `auth.autoRefresh: true` 但未实现。当 session 快过期时应自动刷新，防止用户意外登出 | P1 |
| A-5 | 自动锁定 | 配置中有 `security.autoLockTimeout` 但未实现。长时间不操作后应锁定界面，要求重新验证 | P2 |
| A-6 | 本地数据加密 | 配置中有 `security.encryptLocalData` 但 SQLite 数据库和 electron-store 中的数据实际上未加密。WebDAV 密码以明文存储在 electron-store | P1 |

---

### 阶段三：会话管理（Session） — 当前状态：基础功能

**现有基础：** `SessionManager` 支持 cookie 快照/恢复，共享标签页。

| # | 功能 | 说明 | 优先级 |
|---|------|------|--------|
| S-1 | 会话持久化到磁盘 | 当前 cookie 快照仅存在内存 `Map` 中，应用重启后丢失。需要将会话持久化到加密存储 | P0 |
| S-2 | 标签页状态恢复 | 应用重启后应恢复上次打开的所有标签页（URL、滚动位置等），而非总是打开一个新标签 | P0 |
| S-3 | 浏览历史记录 | 无历史记录功能。需要记录用户浏览过的页面，支持搜索和筛选 | P1 |
| S-4 | 多窗口支持 | 目前仅支持单窗口。考虑支持多窗口，每个窗口独立管理标签页 | P2 |

---

### 阶段四：资源监控（Resource Monitor） — 当前状态：基本框架

**现有基础：** 定时检查总体内存/CPU，根据评分算法选择标签页挂起。

| # | 功能 | 说明 | 优先级 |
|---|------|------|--------|
| R-1 | 单标签页资源追踪 | 当前仅追踪主进程总体资源，未能区分各 webview 的资源消耗。应利用 `webContents.getProcessId()` 或 `app.getAppMetrics()` 获取每个 webview 的 CPU/内存数据 | P1 |
| R-2 | 资源监控面板 UI | 用户无法查看各标签页的资源使用情况。需要一个简单的面板显示各标签页内存、CPU | P2 |
| R-3 | 资源使用告警 | 当资源使用持续过高时，除了自动挂起标签页外，应给用户一个通知提示 | P2 |
| R-4 | 可配置的挂起策略 | 当前挂起策略硬编码在代码中。应允许用户选择策略（如：从不挂起、仅挂起超过 N 分钟未访问的标签页等） | P2 |

---

### 阶段五：收藏系统（Bookmarks） — 当前状态：核心功能已完成

**现有基础：** CRUD、文件夹、批量操作、搜索、访问计数、WebDAV 同步。

| # | 功能 | 说明 | 优先级 |
|---|------|------|--------|
| B-1 | 书签导入/导出 | 支持从浏览器 HTML 书签文件或 JSON 格式导入/导出书签 | P1 |
| B-2 | 书签拖拽排序 | 允许通过拖拽来调整书签顺序和移动到不同文件夹 | P1 |
| B-3 | 文件夹右键操作 | 在侧边栏文件夹上右键弹出菜单，支持重命名、删除、移动 | P1 |
| B-4 | 快速收藏当前页 | 在地址栏添加一键收藏按钮，自动填充当前页面标题和 URL | P0 |
| B-5 | 书签栏 | 在地址栏下方添加一个可选的快速访问书签栏 | P2 |
| B-6 | 数据库列名映射 | SQLite 使用 snake_case 列名（如 `folder_id`、`visit_count`），但 TypeScript 接口使用 camelCase（如 `folderId`、`visitCount`）。数据库查询结果的字段名实际上是 snake_case，与接口不匹配。需要在 DAO 层做映射转换 | P0 |

---

### 阶段六：WebDAV 同步 — 当前状态：书签同步已实现

| # | 功能 | 说明 | 优先级 |
|---|------|------|--------|
| W-1 | 设置面板同步 | 除书签外，也应同步用户设置/配置 | P2 |
| W-2 | 同步冲突 UI | 当前冲突自动解决。应在出现冲突时提示用户选择保留本地/远端/合并 | P2 |
| W-3 | 同步日志 | 记录每次同步的详细日志，用户可查看同步历史 | P3 |
| W-4 | WebDAV 连通性测试 | 在设置页面提供「测试连接」按钮，验证 WebDAV 配置是否正确 | P1 |

---

### UI/UX 增强

| # | 功能 | 说明 | 优先级 |
|---|------|------|--------|
| U-1 | 设置面板 | **关键缺失**。`ConfigService` 后端已完整，但没有任何设置 UI。用户完全无法修改配置（主题、资源限制、WebDAV、安全等） | P0 |
| U-2 | 键盘快捷键 | 无任何键盘快捷键。应支持：`Ctrl/Cmd+T` 新标签、`Ctrl/Cmd+W` 关闭标签、`Ctrl/Cmd+R` 刷新、`Ctrl/Cmd+L` 聚焦地址栏、`Ctrl/Cmd+1~9` 切换标签等 | P0 |
| U-3 | 标签页拖拽排序 | 标签页无法通过拖拽重新排列 | P1 |
| U-4 | 右键上下文菜单 | webview 和标签页均无右键菜单。应支持：在新标签页打开、复制链接、查看源码、检查元素等 | P1 |
| U-5 | 通知/Toast 系统 | 操作反馈（保存成功、同步完成、错误提示）仅通过 `console.error` 或 `setError` 显示。需要一个统一的 Toast 通知组件 | P1 |
| U-6 | 深色/浅色主题切换 | 配置中有 `ui.theme` 字段，UI 已硬编码为深色主题。需要实现实际的主题切换逻辑 | P1 |
| U-7 | 下载管理 | 无文件下载处理。用户在 webview 中触发下载时应有下载管理界面 | P2 |
| U-8 | 缩放控制 | 无页面缩放功能（放大/缩小/重置） | P2 |
| U-9 | 查找功能 | 无页内文字搜索功能（Ctrl/Cmd+F） | P1 |
| U-10 | 打印支持 | 无打印功能 | P3 |
| U-11 | React Error Boundary | 渲染层无错误边界，组件崩溃会导致整个页面白屏 | P0 |
| U-12 | 标签页加载状态指示 | 标签页上未显示加载进度（旋转图标等），虽然 `isLoading` 字段已在数据模型中 | P1 |
| U-13 | 地址栏自动补全 | 地址栏无历史/书签自动补全功能 | P2 |

---

### 平台与发布

| # | 功能 | 说明 | 优先级 |
|---|------|------|--------|
| P-1 | Linux 打包目标 | `electron-builder.json` 仅配置了 macOS 和 Windows 目标，缺少 Linux（AppImage、deb、snap 等） | P1 |
| P-2 | 自动更新 | 未集成 `electron-updater`，应用无法自动检查和安装更新 | P2 |
| P-3 | 自定义协议处理 | 不支持 `nodeseek://` 自定义协议，无法从外部打开指定链接 | P3 |
| P-4 | 系统托盘 | 无系统托盘图标，关闭窗口后进程直接退出。可选支持最小化到托盘 | P2 |
| P-5 | 窗口状态持久化 | 窗口大小和位置不会被记住。重启应用后应恢复上次的窗口状态 | P1 |
| P-6 | 应用图标 | 未提供自定义应用图标（缺少 `assets/` 目录中的图标文件） | P1 |
| P-7 | 代码签名 | macOS/Windows 代码签名流程未配置 | P2 |

---

### 测试与质量

| # | 功能 | 说明 | 优先级 |
|---|------|------|--------|
| T-1 | 单元测试可运行性 | `BookmarkManager` 测试依赖 Electron 的 `app` 模块（`app.getPath`、`app.getAppPath`），在纯 Node.js 环境无法运行。需要 mock Electron 或重构为可注入路径 | P0 |
| T-2 | E2E 测试覆盖率 | 当前 E2E 测试非常浅（仅检查页面加载和书签创建）。应覆盖标签页操作、导航、设置等核心流程 | P1 |
| T-3 | CI 流水线补充 | 缺少 lint 检查、typecheck 步骤。`release.yml` 仅在发布时运行，应增加 PR 级别的 CI 检查 | P1 |
| T-4 | 集成测试 | 缺少 IPC 通道的集成测试，确保主进程和渲染进程间通信正确 | P2 |

---

## 三、优先级说明

| 优先级 | 含义 | 建议时间线 |
|--------|------|-----------|
| **P0** | 核心缺失 / 阻碍正常使用 | 下一个迭代周期 |
| **P1** | 重要功能 / 明显体验不足 | 近期 2-3 个迭代 |
| **P2** | 增强体验 / 锦上添花 | 中期规划 |
| **P3** | 远期规划 / 低频需求 | 可按需推迟 |

---

## 四、P0 优先级汇总（建议首批实现）

1. **U-1** 设置面板 — 用户完全无法修改配置
2. **U-2** 键盘快捷键 — 基本浏览器体验必备
3. **U-11** React Error Boundary — 防止白屏崩溃
4. **A-1** 登录界面 — 认证系统无入口
5. **S-1** 会话持久化 — 重启丢失登录状态
6. **S-2** 标签页状态恢复 — 重启丢失所有标签
7. **B-4** 快速收藏当前页 — 书签系统的核心入口
8. **B-6** 数据库列名映射 — 数据不匹配会导致运行时错误
9. **T-1** 单元测试可运行 — 确保代码质量可验证

---

## 五、建议的开发路线图

```
迭代 1（基础可用性）
├── 设置面板 UI (U-1)
├── 键盘快捷键 (U-2)
├── React Error Boundary (U-11)
├── 数据库列名映射修复 (B-6)
└── 单元测试 mock 修复 (T-1)

迭代 2（认证与会话）
├── 登录界面 (A-1)
├── 会话持久化 (S-1)
├── 标签页状态恢复 (S-2)
├── 登录状态指示 (A-3)
└── 本地数据加密 (A-6)

迭代 3（体验优化）
├── 快速收藏当前页 (B-4)
├── 主题切换 (U-6)
├── 通知系统 (U-5)
├── 右键菜单 (U-4)
├── 标签页加载状态 (U-12)
└── 页内搜索 (U-9)

迭代 4（功能完善）
├── 书签导入/导出 (B-1)
├── 标签页/书签拖拽排序 (U-3, B-2)
├── 多账号管理 (A-2)
├── 会话自动刷新 (A-4)
└── 浏览历史 (S-3)

迭代 5（平台与发布）
├── Linux 打包 (P-1)
├── 窗口状态持久化 (P-5)
├── 应用图标 (P-6)
├── CI 流水线完善 (T-3)
├── E2E 测试补充 (T-2)
└── 自动更新 (P-2)

远期规划
├── 资源监控面板 (R-2)
├── 自定义协议 (P-3)
├── 系统托盘 (P-4)
├── 下载管理 (U-7)
├── 同步冲突 UI (W-2)
└── 多窗口支持 (S-4)
```

---

> 本文档由代码审查自动生成，建议定期更新以反映最新进度。
